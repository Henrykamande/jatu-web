<template>
  <div>
    <div class="flex text-white px-6 py-2 justify-between font-bold bg-orange-500">
      <div style="color: #fff; font-family: Caveat">
        <div class="flex">
          <a href="https://www.facebook.com/share/152Vha19RMg/GM" target="_blank">
            <svg class="bi bi-facebook h-6 w-6 md:h-6 md:w-6 mr-2 cursor-pointer text-gray-300 hover:text-white"
              xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
            </svg>
          </a>
          <!-- linked in -->
          <a href="#" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-4 md:h-6 md:w-6 mr-4 text-indigo-50"
              viewBox="0 0 24 24">
              <path
                d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
            </svg>
          </a>

          <!-- instagram -->
          <a href="https://www.instagram.com/jani_afrofarms?igsh=ZmxjNXV1cG43eWl6" target="_blank">
            <svg class="bi bi-instagram h-6 w-6 md:h-6 md:w-6 cursor-pointer text-gray-300 hover:text-white"
              xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
            </svg>
          </a>
        </div>
      </div>
      <div class="text-white">
        Translator
        <!-- <v-google-translate></v-google-translate> -->
      </div>
    </div>
    <!-- top header -->
    <div class="items-center justify-center grid md:grid-cols-8 p-4">
      <!-- logo div -->
      <div class="col-span-3 flex items-center justify-start">
        <div>
          <nuxt-link to="/">
            <img src="~assets/images/jani-logo.png" alt class="h-16 md:h-16 md:pt-2 object-contain"
              style="width: 200px; height: 200px; transform: scale(1.7)" />
          </nuxt-link>
        </div>
        <div class="flex justify-center text-xl font-bold text-white"></div>
      </div>
      <!-- end -->

      <!-- div 2 -->
      <div class="col-span-2 md:justify-around relative mx-3">
        <div></div>
        <div v-if="searchResults && searchResults.length > 0"
          class="transition duration-500 ease-in-out searchDiv bg-white shadow-md absolute mt-10 border-t border-gray-200 md:justify-around w-full h-72 top-0 z-10">
          <nuxt-link class="w-full bg-gray-200" v-for="item in searchResults" :key="`${item.url}-${item.name}`"
            :to="`/product/${item.url}`">
            <div class="border-b border-white bg-gray-100 p-1">{{ item.name }}</div>
          </nuxt-link>
        </div>
        <!-- search results -->

        <!-- end of search results -->
      </div>
      <!-- end -->

      <!-- div 4 -->
      <div class="col-span-2 flex justify-end pr-8 font-bold text-xl">
        Call: +254 752 940 909
      </div>
      <div class="col-span-1 text-gray-600 flex justify-center">
        <div v-if="isAuthenticated">
          <div class="col-span-1 flex place-content-center relative">
            <div>
              <button @click="showMenu" class="flex flex-col items-center border border-gray-200 p-1 rounded ">
                <font-awesome-icon :icon="['fas', 'user-circle']" class="text-white md:text-2xl" />
                <span class="font-semibold text-xs">{{ userName }}</span>
              </button>
            </div>
            <div v-if="showDropdown" class="absolute right-0 mt-14 w-30 bg-gray-100 border rounded-md shadow">
              <ul>
                <li>
                  <nuxt-link to="/my-details/account" class="block px-2 py-2 hover:bg-gray-100">Account</nuxt-link>
                </li>
                <li>
                  <nuxt-link to="/my-details/equipments" class="block px-2 py-2 hover:bg-gray-100">Equipments</nuxt-link>
                </li>
                <li>
                  <nuxt-link to="/my-details/farms" class="block px-2 py-2 hover:bg-gray-100">Farms</nuxt-link>
                </li>
                <li>
                  <button @click="logout" class="flex px-2 py-2 text-red-600 hover:bg-gray-100 w-full text-left">
                    <span>Logout</span>
                  </button>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- v-else -->
        <div class="text-white w-16 bg-orange-400 px-2 py-1 rounded font-bold" v-else>
          <nuxt-link to="/global-auth/login">
            Login
          </nuxt-link>
        </div>
      </div>
    </div>
    <!-- end  of top bar-->

    <!-- navbar -->
    <!-- #2f93a3 -->
    <div class="md:flex items-center px-3 justify-between">
      <nav class="ml-4">
        <ul class="md:flex flex-wrap">
          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/">Home</nuxt-link>
          </li>
          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/about">About Us</nuxt-link>
          </li>

          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/services">Agri
              Support</nuxt-link>
          </li>

          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/projects">Partnership
              Projects</nuxt-link>
            <!-- <div class="absolute left-0 top-fdivl bg-white text-gray-800 rounded-md shadow-lg hidden group-hover:block">
              <nuxt-link to="/agriculture" class="block px-4 py-2 hover:bg-gray-100">Agriculture</nuxt-link>
              <nuxt-link to="/mining" class="block px-4 py-2 hover:bg-gray-100">Mining</nuxt-link>
              <nuxt-link to="/real-estate" class="block px-4 py-2 hover:bg-gray-100">Real Estate</nuxt-link>
            </div> -->
          </li>

          <!-- Services -->
          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="#">Services</nuxt-link>
            <div class="absolute left-0 top-fdivl bg-white text-gray-800 rounded-md shadow-lg hidden group-hover:block">
              <nuxt-link to="/farmlands" class="block px-4 py-2 hover:bg-gray-100">Farmlands</nuxt-link>
              <nuxt-link to="/equipment" class="block px-4 py-2 hover:bg-gray-100">Equipment</nuxt-link>
              <!-- <nuxt-link to="/management" class="block px-4 py-2 hover:bg-gray-100">Management</nuxt-link>
              <nuxt-link to="/financing" class="block px-4 py-2 hover:bg-gray-100">Financing</nuxt-link>
              <nuxt-link to="/marketing" class="block px-4 py-2 hover:bg-gray-100">Marketing</nuxt-link> -->
            </div>
          </li>

          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/location">Our
              Location</nuxt-link>
          </li>
          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/blog">Blog</nuxt-link>
          </li>
          <li class="menu-li group inline-block relative">
            <nuxt-link class="font-medium text-lg text-white p-2 hover:text-orange-500" to="/contact-us">Contact
              Us</nuxt-link>
          </li>
        </ul>
      </nav>

      <div class="pr-56">
        <li class="menu-li group inline-block relative">
          <nuxt-link class="font-medium text-lg text-white p-2" to="/">E-Commerce</nuxt-link>
        </li>
      </div>
    </div>
    <!-- end of navbar -->
  </div>
</template>

<script>
import { http } from "~/common/index.js";
import { mapGetters } from "vuex";
export default {
  components: {
  },
  computed: {
    ...mapGetters(["imageUrl", "user"]),
    ...mapGetters("product", ["cart"]),
    isAuthenticated() {
      return process.client ? !!localStorage.getItem("token") : false;
    },
    userName() {
      if (process.client) {
        const user = JSON.parse(localStorage.getItem("user"));
        return `${user.first_name || "Guest"} ${user.last_name || ""}`.trim()
      }
    }
    // user() {
    //   const token = localStorage.getItem("token");
    //   return token;
    //   // var decoded = jwt_decode(token);
    //   // return decoded;
    // },
  },
  data() {
    return {
      categories: [],
      services: [],
      searchInput: null,
      searchPhrase: "",
      active: false,
      searchResults: [],
      searchSuggestions: [],
      blured: true,
      disabled: true,
      showDropdown: false,
      languages: [
        {
          code: "en|af",
          title: "Afrikaans"
        },
        {
          code: "en|ar",
          title: "Arabic"
        },
        {
          code: "en|ko",
          title: "Korean"
        },
        {
          code: "en|lt",
          title: "Lithuanian"
        }
      ]
    };
  },
  async fetch() {
    const url = `api/categories`;
    const servicesUrl = `api/services`;
    const host = this.imageUrl;
    const data = await fetch(`${host}/${url}`).then(res => res.json());
    // fetch services
    const servicesData = await fetch(`${host}/${servicesUrl}`).then(res =>
      res.json()
    );
    // end
    this.categories = data.records;
    this.services = servicesData.records;
  },
  watch: {
    $route() {
      this.searchResults = [];
    }
  },
  methods: {
    userMenu() {
      const menuBtn = document.querySelector("#menu-btn");
      const dropdown = document.querySelector("#dropdown");

      dropdown.classList.toggle("hidden");
      dropdown.classList.toggle("block");
    },
    showMenu() {
      this.showDropdown = !this.showDropdown;
    },
    logout() {
      this.$store.commit("logout");
      window.location.reload();
    },
    async search() {
      const keyword = this.searchPhrase.trim().toLowerCase();
      const url = `/api/products/search/${keyword}`;

      try {
        const { data } = await http.get(url);
        const { searchResults } = data;
        this.searchResults = searchResults;
      } catch (err) {
        this.searchResults = [];
      }
    },
    activateSearch() {
      this.blured = false;
    },
    enterEvent() {
      this.searchResults = [];
    }
  },
  created() {

  }
};
</script>

<style scoped>
.menu-li {
  @apply py-2;
  md: py-0;
}

.search-drop-down {
  /* min-height: 40px; */
  /* transition: all 0.3s ease-in-out; */
  position: absolute;
  margin-top: 40px;
  z-index: 300;
}

/* drop down styles */
.search-drop {
  background: #fff;
  transition: all 0.3s ease-in-out;
  border-top: 1px solid #e3e3e3;
  transform: scaleY(0);
  transform-origin: top;
  transition: transform 0.26s ease;
  box-shadow: 2px 2px 4px #bdbdbd;
}

.searching {
  min-height: 30px;
  /* transition: all 0.3s ease-in-out; */
  transform: scaleY(1);
}
</style>